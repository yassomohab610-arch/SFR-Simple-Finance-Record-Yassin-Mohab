<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SFR | Simple Finance Record v7.2</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --bg: #f8fafc; --card: #ffffff; --text: #0f172a; --danger: #ef4444; --success: #22c55e; --accent: #f1f5f9; }
        body.dark { --bg: #020617; --card: #1e293b; --text: #f1f5f9; --accent: #334155; }

        body.rtl { direction: rtl; font-family: 'Cairo', sans-serif; }
        body.ltr { direction: ltr; font-family: 'Inter', sans-serif; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .app-container { animation: fadeIn 0.8s ease-out; }
        .privacy-active .blur-val { filter: blur(10px); transition: filter 0.3s ease; }

        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10000; transition: opacity 0.8s ease; }
        .logo-anim { font-size: 80px; animation: pulse 2s infinite ease-in-out; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 1; } 100% { transform: scale(1); opacity: 0.8; } }

        .loading-bar { width: 180px; height: 4px; background: #334155; border-radius: 10px; margin-top: 25px; overflow: hidden; }
        .loading-progress { width: 0%; height: 100%; background: var(--primary); animation: load 2.5s forwards; }
        @keyframes load { to { width: 100%; } }

        #lock-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--bg); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        #lock-error { color: var(--danger); font-size: 0.9rem; margin-top: 10px; font-weight: bold; display: none; }

        html, body { overflow-x: hidden; width: 100%; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--text); transition: background 0.3s, color 0.3s; }
        .app-container { display: none; padding: 15px; max-width: 1200px; margin: auto; }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .menu-wrapper { position: relative; }
        .menu-dot-btn { background: var(--accent); border: none; font-size: 24px; cursor: pointer; color: var(--text); padding: 5px 15px; border-radius: 10px; transition: 0.2s; }

        .dropdown-menu { 
            display: none; position: absolute; top: 45px; right: 0; background: var(--card); 
            border: 1px solid var(--accent); border-radius: 15px; width: 220px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 1000; overflow: hidden;
            animation: slideDown 0.3s ease-out;
        }
        body.rtl .dropdown-menu { right: auto; left: 0; }

        .dropdown-menu button { 
            width: 100%; padding: 12px 15px; border: none; background: none; 
            color: var(--text); text-align: inherit; cursor: pointer; font-size: 0.9rem;
            display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--accent);
        }
        .dropdown-menu button:hover { background: var(--accent); }

        .global-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: white; padding: 20px; border-radius: 24px; text-align: center; margin-bottom: 25px; }
        .account-dash { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 25px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 20px; text-align: center; border: 1px solid var(--accent); }
        .main-grid { display: grid; grid-template-columns: 380px 1fr; gap: 20px; width: 100%; }
        @media (max-width: 1000px) { .main-grid { grid-template-columns: 1fr; } }

        .card { background: var(--card); padding: 20px; border-radius: 24px; border: 1px solid var(--accent); margin-bottom: 20px; }
        
        input, select { 
            width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 10px; 
            border: 1px solid #ddd; background: var(--bg); color: var(--text); 
            box-sizing: border-box; display: block;
        }

        .btn-primary { background: var(--primary); color: white; width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-tool { background: var(--accent); color: var(--text); padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer; font-size: 0.85rem; font-weight: 600; }

        .item { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 16px; border-radius: 16px; margin-bottom: 10px; border: 1px solid var(--accent); border-left: 6px solid var(--primary); animation: slideIn 0.3s ease-out; }
        body.rtl .item { border-left: none; border-right: 6px solid var(--primary); }

        .hist-cat { font-weight: 600; font-size: 1rem; }
        body.rtl .hist-cat { font-weight: 700; }

        /* Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‡ÙŠØ³ØªÙˆØ±ÙŠ */
        .search-container { position: relative; margin-bottom: 15px; }
        .search-input { padding-left: 40px !important; }
        body.rtl .search-input { padding-left: 12px !important; padding-right: 40px !important; }
        .search-icon { position: absolute; top: 12px; left: 12px; color: #94a3b8; }
        body.rtl .search-icon { left: auto; right: 12px; }

        .swal2-popup { background: var(--card) !important; color: var(--text) !important; border-radius: 25px !important; padding: 20px !important; }
        .swal2-title { color: var(--text) !important; font-size: 1.2rem !important; margin-bottom: 10px !important; }
        
        .swal2-input, .swal2-select { 
            height: 45px !important;
            width: 85% !important; 
            margin: 10px auto !important;
            border-radius: 12px !important;
            background: var(--bg) !important;
            color: var(--text) !important;
            text-align: center !important;
            font-size: 1rem !important;
            border: 1px solid var(--accent) !important;
        }
        
        .swal2-select { text-align-last: center !important; padding: 0 10px !important; }

        .modal-calc { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 5000; justify-content: center; align-items: center; }
        .calc-box { background: #1e293b; padding: 20px; border-radius: 25px; width: 300px; }
        .calc-screen { background: #0f172a; color: #10b981; font-family: monospace; font-size: 2rem; padding: 15px; text-align: right; border-radius: 10px; margin-bottom: 15px; min-height: 50px; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .calc-grid button { padding: 15px; border: none; border-radius: 12px; background: #334155; color: white; font-weight: bold; }

        .footer-custom { margin-top: 60px; padding: 40px 20px; border-top: 1px solid var(--accent); text-align: center; }
        #privacy-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); color: var(--text); padding: 30px; z-index: 20000; overflow-y: auto; box-sizing: border-box; }
    </style>
</head>
<body class="ltr">

<div id="splash-screen">
    <div class="logo-anim">ğŸ¦</div>
    <h1 style="color: white; margin: 15px 0 0 0; letter-spacing: 5px; font-size: 45px;">SFR</h1>
    <p style="color: #6366f1;">Simple Finance Record</p>
    <div class="loading-bar"><div class="loading-progress"></div></div>
</div>

<div id="lock-screen">
    <h2 id="ui-locked">ğŸ” SFR Locked</h2>
    <input type="password" id="unlockPass" placeholder="..." style="width: 260px; text-align: center;" oninput="hideLockError()">
    <button class="btn-primary" style="width: 260px;" onclick="verifyLock()" id="ui-unlock-btn">Unlock</button>
    <div id="lock-error">âš ï¸ Wrong Password!</div>
</div>

<div class="app-container" id="mainApp">
    <header>
        <h2 id="ui-title">SFR Dashboard</h2>
        <div class="menu-wrapper">
            <button class="menu-dot-btn" onclick="toggleMenu(event)">â‹®</button>
            <div id="dropdown" class="dropdown-menu">
                <button onclick="openCalc()">ğŸ“Ÿ <span id="ui-menu-calc">Calculator</span></button>
                <button onclick="toggleLang()">ğŸŒ <span id="ui-menu-lang">Change Language</span></button>
                <button onclick="toggleTheme()">ğŸŒ“ <span id="ui-menu-theme">Dark/Light Mode</span></button>
                <button onclick="togglePrivacy()">ğŸ‘ï¸ <span id="ui-menu-blur">Toggle Blur</span></button>
                <button id="m-set-pass" onclick="handleSetPass()">ğŸ”‘ Set Password</button>
                <button id="m-del-pass" onclick="deletePass()" style="color:var(--danger)">ğŸ—‘ï¸ Delete Pass</button>
                <button onclick="location.reload()">ğŸ”’ Lock App</button>
            </div>
        </div>
    </header>

    <div class="global-stats">
        <div><small id="ui-g-inc">Incomes</small><h3 id="val-g-inc" class="blur-val" style="color:var(--success)">0</h3></div>
        <div><small id="ui-g-exp">Expenses</small><h3 id="val-g-exp" class="blur-val" style="color:var(--danger)">0</h3></div>
        <div><small id="ui-g-net">Net Worth</small><h3 id="val-g-net" class="blur-val">0</h3></div>
    </div>

    <div class="account-dash">
        <div class="stat-card"><small id="ui-init">Initial</small><h3 id="val-init" class="blur-val">0</h3></div>
        <div class="stat-card"><small id="ui-inc">In</small><h3 id="val-inc" class="blur-val" style="color:var(--success)">0</h3></div>
        <div class="stat-card"><small id="ui-exp">Out</small><h3 id="val-exp" class="blur-val" style="color:var(--danger)">0</h3></div>
        <div class="stat-card" style="background: var(--primary); color: white;"><small id="ui-bal" style="color:#e0e7ff">Balance</small><h3 id="val-bal" class="blur-val">0</h3></div>
    </div>

    <div class="main-grid">
        <div class="side">
            <div class="card">
                <select id="accSelect" onchange="switchAccount()"></select>
                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    <button class="btn-tool" onclick="addAcc()" id="ui-add-acc">+ New</button>
                    <button class="btn-tool" onclick="renameAcc()">âœï¸</button>
                    <button class="btn-tool" onclick="delAcc()" style="color:var(--danger)">ğŸ—‘ï¸</button>
                    <button class="btn-tool" onclick="modifyInitial()" style="background:#f59e0b; color:white" id="ui-init-btn">Initial Balance</button>
                </div>
            </div>
            <div class="card">
                <form onsubmit="addEntry(event)">
                    <select id="catSelect"></select>
                    <input id="descInp" placeholder="Description">
                    <input type="number" id="amtInp" placeholder="Amount" step="0.01" required>
                    <select id="typeInp">
                        <option value="expense" id="ui-opt-exp">Expense (-)</option>
                        <option value="income" id="ui-opt-inc">Income (+)</option>
                    </select>
                    <button class="btn-primary" id="ui-save">Post to SFR</button>
                </form>
            </div>
        </div>
        <div class="content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                <h3 id="ui-hist">History</h3>
                <select id="monthFilter" style="width:auto; margin:0" onchange="render()"></select>
            </div>
            
            <div class="search-container">
                <span class="search-icon">ğŸ”</span>
                <input type="text" id="searchInput" class="search-input" placeholder="Search by name or description..." oninput="render()">
            </div>

            <div id="transList"></div>
        </div>
    </div>

    <footer class="footer-custom">
        <p style="color: #64748b;" id="ui-dev-by">Designed & Developed by</p>
        <p style="font-size: 1.3rem; font-weight: 700;">Yassin Mohab Mohamed</p>
        <p style="color: #94a3b8; font-size: 0.85rem;">Â© 2025 SFR - v7.2</p>
        <span style="color:var(--primary); cursor:pointer; text-decoration:underline" onclick="openPrivacy()">Privacy Policy | Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</span>
    </footer>
</div>

<div id="calcModal" class="modal-calc">
    <div class="calc-box">
        <div class="calc-screen" id="calcDisplay">0</div>
        <div class="calc-grid">
            <button onclick="calcClear()" style="color:var(--danger)">C</button>
            <button onclick="calcPop()">âŒ«</button>
            <button onclick="calcIn('/')" style="background:var(--primary); color:white">Ã·</button>
            <button onclick="calcIn('*')" style="background:var(--primary); color:white">Ã—</button>
            <button onclick="calcIn('7')">7</button><button onclick="calcIn('8')">8</button><button onclick="calcIn('9')">9</button>
            <button onclick="calcIn('-')" style="background:var(--primary); color:white">-</button>
            <button onclick="calcIn('4')">4</button><button onclick="calcIn('5')">5</button><button onclick="calcIn('6')">6</button>
            <button onclick="calcIn('+')" style="background:var(--primary); color:white">+</button>
            <button onclick="calcIn('1')">1</button><button onclick="calcIn('2')">2</button><button onclick="calcIn('3')">3</button>
            <button onclick="calcRes()" style="background:var(--primary); color:white; grid-row: span 2;">=</button>
            <button onclick="calcIn('0')" style="grid-column: span 2;">0</button>
            <button onclick="calcIn('.')">.</button>
            <button onclick="closeCalc()" style="grid-column: span 4; background:var(--danger); color:white; margin-top:10px">Close</button>
        </div>
    </div>
</div>

<div id="privacy-modal">
    <div style="max-width:800px; margin:auto; padding:20px;">
        <button class="btn-primary" onclick="closePrivacy()" style="margin-bottom: 20px;">Close / Ø¥ØºÙ„Ø§Ù‚</button>
        <div style="text-align: left; line-height: 1.6;">
            <h2>Privacy Policy</h2>
            <p><strong>SFR app was developed by Yassin Mohab Mohamed</strong></p>
            <p><strong>1. Data Storage:</strong> All your financial data, transactions, and account names are stored locally on your device's browser memory (LocalStorage). We do not have access to your data.</p>
            <p><strong>2. No Cloud Sync:</strong> This app does not use any servers or cloud databases. If you clear your browser cache or delete site data, your records will be permanently lost unless you have a backup.</p>
            <p><strong>3. Ads & Third-Party Disclosure:</strong> We use Google AdMob to display advertisements to support the ongoing development of this application. Google may use anonymous advertising identifiers to serve ads tailored to your interests. We guarantee that these identifiers are never linked to your private financial data stored within the app.</p>
            <p><strong>4. Access Permissions & Privacy:</strong> This app is designed to fully protect your privacy; therefore, it does not request any system permissions, such as access to your camera, location, contacts, or personal photos. The app operates completely independently and only requires access to the browser's local storage (LocalStorage) to save the financial data you enter yourself, ensuring your information remains solely under your control.</p>
            <p><strong>5. Security:</strong> The password feature is a local barrier. It is not encrypted on a server. It is designed for basic privacy from people using the same device.</p>
            
            <h2 style="border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-top: 30px;">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h2>
            <p><strong>1. ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆÙ…Ø¹Ø§Ù…Ù„Ø§ØªÙƒ ÙˆØ£Ø³Ù…Ø§Ø¡ Ø­Ø³Ø§Ø¨Ø§ØªÙƒ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ù…ØªØµÙØ­ Ø¬Ù‡Ø§Ø²Ùƒ (LocalStorage). Ù†Ø­Ù† Ù„Ø§ Ù†Ù…Ù„Ùƒ Ø£ÙŠ ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.</p>
            <p><strong>2. Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø²Ø§Ù…Ù†Ø© Ø³Ø­Ø§Ø¨ÙŠØ©:</strong> Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… Ø£ÙŠ Ø®ÙˆØ§Ø¯Ù… Ø£Ùˆ Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø­Ø§Ø¨ÙŠØ©. Ø¥Ø°Ø§ Ù‚Ù…Øª Ø¨Ù…Ø³Ø­ Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù„Ù…ØªØµÙØ­ØŒ ÙØ³ØªÙÙ‚Ø¯ Ø³Ø¬Ù„Ø§ØªÙƒ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.</p>
            <p><strong>3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ù…ÙØ¹Ù„Ù†ÙŠÙ†:</strong> Ù†Ø­Ù† Ù†Ø³ØªØ®Ø¯Ù… Ø®Ø¯Ù…Ù‡ Google AdMob Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ø¯Ø¹Ù… Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. Ù‚Ø¯ ÙŠØ³ØªØ®Ø¯Ù… Ø¬ÙˆØ¬Ù„ Ù…Ø¹Ø±ÙØ§Øª Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ù…Ø¬Ù‡ÙˆÙ„Ø© Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØªÙ†Ø§Ø³Ø¨ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ. Ù†Ø¤ÙƒØ¯ Ø£Ù†Ù‡ Ù„Ø§ ÙŠØªÙ… Ø±Ø¨Ø· Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª Ø¨Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</p>
            <p><strong>4. ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©:</strong> Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ØµÙ…Ù… Ù„Ø­Ù…Ø§ÙŠØ© Ø®ØµÙˆØµÙŠØªÙƒ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„Ø› Ù„Ø°Ø§ ÙÙ‡Ùˆ Ù„Ø§ ÙŠØ·Ù„Ø¨ Ø£ÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØµÙˆÙ„  Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø¬Ù‡Ø§Ø²ÙƒØŒ Ù…Ø«Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ØŒ Ø£Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø£Ùˆ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ØŒ Ø£Ùˆ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø´Ø®ØµÙŠØ©. ÙŠØ¹Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ‚Ù„ ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆÙ„Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ø§ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù„Ù„Ù…ØªØµÙØ­ Ù„Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¯Ø®Ù„Ù‡Ø§ Ø¨Ù†ÙØ³ÙƒØŒ Ù…Ù…Ø§ ÙŠØ¶Ù…Ù† Ø¨Ù‚Ø§Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ ØªØ­Øª Ø³ÙŠØ·Ø±ØªÙƒ ÙÙ‚Ø·.</p>
            <p><strong>5. Ø§Ù„Ø£Ù…Ø§Ù†:</strong> Ù…ÙŠØ²Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‡ÙŠ Ø­Ø§Ø¬Ø² Ù…Ø­Ù„ÙŠ ÙÙ‚Ø· ÙˆÙ„ÙŠØ³Øª Ù…Ø´ÙØ±Ø© Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… Ø®Ø§Ø±Ø¬ÙŠ. Ù‡ÙŠ Ù…ØµÙ…Ù…Ø© Ù„Ù„Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ø°ÙŠÙ† ÙŠØ³ØªØ®Ø¯Ù…ÙˆÙ† Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø².</p>
        </div>
    </div>
</div>

<script>
    let lang = localStorage.getItem("sfr_lang") || "en";
    let theme = localStorage.getItem("sfr_theme") || "light";
    let privacy = localStorage.getItem("sfr_privacy") === "true";
    let currentIdx = 0;
    let accounts = JSON.parse(localStorage.getItem("sfr_v6_data")) || [{ name: "Main Account", initial: 0, transactions: [] }];
    let sfrPass = localStorage.getItem("sfr_v6_pass");

    const CATEGORIES = {
        en: ["ğŸ‹ï¸ Sport", "ğŸ Gift", "ğŸ” Food", "ğŸ›’ Groceries", "ğŸš— Transport", "ğŸ›ï¸ Shopping", "ğŸ“± Bills", "ğŸ  Rent", "ğŸ’Š Health", "ğŸ“ Education", "ğŸ® Fun", "âœˆï¸ Travel", "ğŸ“ˆ Invest", "ğŸ’° Salary", "â• Other"],
        ar: ["ğŸ‹ï¸ Ø±ÙŠØ§Ø¶Ø©", "ğŸ Ù‡Ø¯ÙŠØ©", "ğŸ” Ø·Ø¹Ø§Ù…", "ğŸ›’ Ø¨Ù‚Ø§Ù„Ø©", "ğŸš— Ù…ÙˆØ§ØµÙ„Ø§Øª", "ğŸ›ï¸ ØªØ³ÙˆÙ‚", "ğŸ“± ÙÙˆØ§ØªÙŠØ±", "ğŸ  Ø³ÙƒÙ†", "ğŸ’Š ØµØ­Ø©", "ğŸ“ ØªØ¹Ù„ÙŠÙ…", "ğŸ® ØªØ±ÙÙŠÙ‡", "âœˆï¸ Ø³ÙØ±", "ğŸ“ˆ Ø§Ø³ØªØ«Ù…Ø§Ø±", "ğŸ’° Ø±Ø§ØªØ¨", "â• Ø£Ø®Ø±Ù‰"]
    };

    const dict = {
        en: { 
            title: "SFR Dashboard", gInc: "Incomes", gExp: "Expenses", gNet: "Net Worth", init: "Initial", inc: "In", exp: "Out", bal: "Balance", hist: "History", save: "Post to SFR",
            menuCalc: "Calculator", menuLang: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", menuTheme: "Dark/Light Mode", menuBlur: "Toggle Blur", setPass: "ğŸ”‘ Set Password", changePass: "ğŸ”„ Change Pass", delPass: "ğŸ—‘ï¸ Delete Pass", locked: "ğŸ” SFR Locked", unlock: "Unlock",
            addAcc: "+ New", optExp: "Expense (-)", optInc: "Income (+)", devBy: "Designed & Developed by", initBtn: "Initial Balance", errPass: "Wrong Current Password!",
            confirmDel: "Are you sure?", enterAccName: "Account Name:", enterNewPass: "New Password:", enterCurrPass: "Current Password:",
            amt: "Edit Amount:", desc: "Edit Description:", selectCat: "ğŸ“ Change Category:", loginErr: "âš ï¸ Wrong Password!",
            searchPlace: "Search by name or description..."
        },
        ar: { 
            title: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… SFR", gInc: "Ø§Ù„Ø¯Ø®Ù„", gExp: "Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ", gNet: "Ø§Ù„Ø«Ø±ÙˆØ©", init: "Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©", inc: "Ø¯Ø§Ø®Ù„", exp: "Ø®Ø§Ø±Ø¬", bal: "Ø§Ù„Ø±ØµÙŠØ¯", hist: "Ø§Ù„Ø³Ø¬Ù„", save: "Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„",
            menuCalc: "Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©", menuLang: "English", menuTheme: "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ", menuBlur: "Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…", setPass: "ğŸ”‘ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„Ù…Ø© Ø³Ø±", changePass: "ğŸ”„ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±", delPass: "ğŸ—‘ï¸ Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±", locked: "ğŸ” SFR Ù…ØºÙ„Ù‚", unlock: "ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚",
            addAcc: "+ Ø¬Ø¯ÙŠØ¯", optExp: "Ù…ØµØ±ÙˆÙ (-)", optInc: "Ø¯Ø®Ù„ (+)", devBy: "ØªÙ… Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø©", initBtn: "Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ", errPass: "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø®Ø§Ø·Ø¦Ø©!",
            confirmDel: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ", enterAccName: "Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:", enterNewPass: "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:", enterCurrPass: "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø­Ø§Ù„ÙŠØ©:",
            amt: "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº:", desc: "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØµÙ:", selectCat: "ğŸ“ ØªØºÙŠÙŠØ± Ø§Ù„ØªØµÙ†ÙŠÙ:", loginErr: "âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©!",
            searchPlace: "Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙˆØµÙ..."
        }
    };

    window.onload = () => {
        applyTheme();
        updateUI();
        setTimeout(() => {
            document.getElementById("splash-screen").style.opacity = "0";
            setTimeout(() => {
                document.getElementById("splash-screen").style.display = "none";
                if(sfrPass) document.getElementById("lock-screen").style.display = "flex";
                else { document.getElementById("mainApp").style.display = "block"; render(); }
            }, 800);
        }, 2000);
    };

    function toggleMenu(e) { 
        if(e) e.stopPropagation();
        const d = document.getElementById("dropdown"); 
        d.style.display = (d.style.display === "block") ? "none" : "block"; 
    }

    window.addEventListener('click', function(e) {
        const dropdown = document.getElementById("dropdown");
        const btn = document.querySelector(".menu-dot-btn");
        if (dropdown && dropdown.style.display === "block" && !dropdown.contains(e.target) && e.target !== btn) {
            dropdown.style.display = "none";
        }
    });

    function toggleLang() { lang = (lang === "en") ? "ar" : "en"; localStorage.setItem("sfr_lang", lang); location.reload(); }
    function toggleTheme() { theme = (theme === "light") ? "dark" : "light"; localStorage.setItem("sfr_theme", theme); applyTheme(); }
    function applyTheme() { document.body.classList.toggle("dark", theme === "dark"); }
    function togglePrivacy() { privacy = !privacy; localStorage.setItem("sfr_privacy", privacy); document.getElementById("mainApp").classList.toggle("privacy-active", privacy); }

    function updateUI() {
        const d = dict[lang];
        document.body.className = (lang === "ar" ? "rtl " : "ltr ") + (theme === "dark" ? "dark" : "");
        document.getElementById("ui-title").innerText = d.title;
        document.getElementById("ui-g-inc").innerText = d.gInc;
        document.getElementById("ui-g-exp").innerText = d.gExp;
        document.getElementById("ui-g-net").innerText = d.gNet;
        document.getElementById("ui-init").innerText = d.init;
        document.getElementById("ui-inc").innerText = d.inc;
        document.getElementById("ui-exp").innerText = d.exp;
        document.getElementById("ui-bal").innerText = d.bal;
        document.getElementById("ui-save").innerText = d.save;
        document.getElementById("ui-hist").innerText = d.hist;
        document.getElementById("ui-menu-calc").innerText = d.menuCalc;
        document.getElementById("ui-menu-lang").innerText = d.menuLang;
        document.getElementById("ui-menu-theme").innerText = d.menuTheme;
        document.getElementById("ui-menu-blur").innerText = d.menuBlur;
        document.getElementById("ui-init-btn").innerText = d.initBtn;
        document.getElementById("m-set-pass").innerText = sfrPass ? d.changePass : d.setPass;
        document.getElementById("m-del-pass").style.display = sfrPass ? "block" : "none";
        document.getElementById("ui-locked").innerText = d.locked;
        document.getElementById("ui-unlock-btn").innerText = d.unlock;
        document.getElementById("ui-add-acc").innerText = d.addAcc;
        document.getElementById("ui-opt-exp").innerText = d.optExp;
        document.getElementById("ui-opt-inc").innerText = d.optInc;
        document.getElementById("ui-dev-by").innerText = d.devBy;
        document.getElementById("lock-error").innerText = d.loginErr;
        document.getElementById("searchInput").placeholder = d.searchPlace;

        const catS = document.getElementById("catSelect");
        catS.innerHTML = "";
        CATEGORIES[lang].forEach(c => catS.innerHTML += `<option value="${c}">${c}</option>`);

        const mS = document.getElementById("monthFilter");
        mS.innerHTML = `<option value="all">${lang === 'ar' ? 'Ø§Ù„ÙƒÙ„' : 'All Time'}</option>`;
        const months = lang === 'ar' ? ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"] : ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        months.forEach((m, i) => mS.innerHTML += `<option value="${i}">${m}</option>`);
    }

    function render() {
        const accSel = document.getElementById("accSelect"); accSel.innerHTML = ""; accounts.forEach((a, i) => { const o = document.createElement("option"); o.value = i; o.text = a.name; accSel.appendChild(o); }); accSel.value = currentIdx;
        let gInc = 0, gExp = 0, gNet = 0; accounts.forEach(acc => { let accNet = acc.initial; acc.transactions.forEach(t => { if(t.type === "income") { gInc += t.amt; accNet += t.amt; } else { gExp += t.amt; accNet -= t.amt; } }); gNet += accNet; });
        
        const cur = accounts[currentIdx]; 
        const filter = document.getElementById("monthFilter").value; 
        const searchQuery = document.getElementById("searchInput").value.toLowerCase();
        
        let cInc = 0, cExp = 0; 
        const list = document.getElementById("transList"); 
        list.innerHTML = "";

        cur.transactions.forEach((t, i) => {
            const tDate = new Date(t.date);
            const matchesMonth = filter === "all" || tDate.getMonth() == filter;
            
            // ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
            const matchesSearch = t.cat.toLowerCase().includes(searchQuery) || 
                                  t.desc.toLowerCase().includes(searchQuery) ||
                                  (t.catIdx !== undefined && CATEGORIES[lang][t.catIdx].toLowerCase().includes(searchQuery));

            if(matchesMonth) { 
                if(t.type === "income") cInc += t.amt; else cExp += t.amt;
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„ÙŠ Ø¨ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø« ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø²Ù…Ù†ÙŠ
                if(matchesSearch) {
                    const dStr = tDate.toLocaleDateString(lang==='ar'?'ar-EG':'en-GB', { day: '2-digit', month: 'short' });
                    const tStr = tDate.toLocaleTimeString(lang==='ar'?'ar-EG':'en-GB', { hour: '2-digit', minute: '2-digit', hour12: true });
                    
                    let displayCat = t.cat;
                    if(t.catIdx !== undefined) { displayCat = CATEGORIES[lang][t.catIdx]; }
                    
                    list.innerHTML = `<div class="item"><span><span class="hist-cat">${displayCat}</span><br><small style="color:#64748b">${t.desc || ''}</small><br><small style="color:#94a3b8; font-size:0.7rem">ğŸ“… ${dStr} | ğŸ•’ ${tStr}</small></span><div style="display:flex; align-items:center; gap:8px"><b class="blur-val" style="color:${t.type==='income'?'var(--success)':'var(--danger)'}">${t.amt.toLocaleString()}</b><button onclick="editFull(${i})" style="background:none; border:none; cursor:pointer">âœï¸</button><button onclick="delT(${i})" style="background:none; border:none; color:red; cursor:pointer">ğŸ—‘ï¸</button></div></div>` + list.innerHTML;
                }
            }
        });
        document.getElementById("val-g-inc").innerText = gInc.toLocaleString(); document.getElementById("val-g-exp").innerText = gExp.toLocaleString(); document.getElementById("val-g-net").innerText = gNet.toLocaleString();
        document.getElementById("val-init").innerText = cur.initial.toLocaleString(); document.getElementById("val-inc").innerText = cInc.toLocaleString(); document.getElementById("val-exp").innerText = cExp.toLocaleString(); document.getElementById("val-bal").innerText = (cur.initial + cInc - cExp).toLocaleString();
    }

    function addEntry(e) { 
        e.preventDefault(); 
        const amt = parseFloat(document.getElementById("amtInp").value); 
        if(amt) { 
            const selectedIdx = document.getElementById("catSelect").selectedIndex;
            accounts[currentIdx].transactions.push({ 
                cat: document.getElementById("catSelect").value, 
                catIdx: selectedIdx,
                desc: document.getElementById("descInp").value || "", 
                amt: amt, 
                type: document.getElementById("typeInp").value, 
                date: new Date().toISOString() 
            }); 
            save(); render(); e.target.reset(); 
        } 
    }
    
    function save() { localStorage.setItem("sfr_v6_data", JSON.stringify(accounts)); }
    function switchAccount() { currentIdx = parseInt(document.getElementById("accSelect").value); render(); }

    async function addAcc() {
        const { value: name } = await Swal.fire({ title: dict[lang].enterAccName, input: 'text', showCancelButton: true, confirmButtonColor: '#6366f1' });
        if (name) { accounts.push({name: name, initial: 0, transactions: []}); save(); render(); }
    }

    async function renameAcc() {
        const { value: name } = await Swal.fire({ title: 'Rename:', input: 'text', inputValue: accounts[currentIdx].name, showCancelButton: true, confirmButtonColor: '#6366f1' });
        if (name) { accounts[currentIdx].name = name; save(); render(); }
    }

    async function delAcc() {
        if (accounts.length > 1) {
            const result = await Swal.fire({ title: dict[lang].confirmDel, icon: 'warning', showCancelButton: true, confirmButtonColor: '#ef4444' });
            if (result.isConfirmed) { accounts.splice(currentIdx, 1); currentIdx = 0; save(); render(); }
        }
    }

    async function modifyInitial() {
        const { value: val } = await Swal.fire({ 
            title: dict[lang].initBtn, 
            input: 'number', 
            inputValue: accounts[currentIdx].initial, 
            showCancelButton: true,
            confirmButtonColor: '#6366f1'
        });
        if (val !== null && val !== undefined) { accounts[currentIdx].initial = parseFloat(val) || 0; save(); render(); }
    }

    async function delT(i) {
        const result = await Swal.fire({ title: dict[lang].confirmDel, icon: 'warning', showCancelButton: true, confirmButtonColor: '#ef4444' });
        if (result.isConfirmed) { accounts[currentIdx].transactions.splice(i, 1); save(); render(); }
    }

    async function editFull(i) {
        const t = accounts[currentIdx].transactions[i];
        const { value: nAmt } = await Swal.fire({ title: dict[lang].amt, input: 'number', inputValue: t.amt, showCancelButton: true, confirmButtonColor: '#6366f1' });
        if (nAmt === undefined) return;
        t.amt = parseFloat(nAmt) || 0;
        const { value: nDesc } = await Swal.fire({ title: dict[lang].desc, input: 'text', inputValue: t.desc, showCancelButton: true, confirmButtonColor: '#6366f1' });
        if (nDesc !== undefined) t.desc = nDesc;
        let catOptions = {}; 
        CATEGORIES[lang].forEach(cat => catOptions[cat] = cat);
        const { value: nCat } = await Swal.fire({ title: dict[lang].selectCat, input: 'select', inputOptions: catOptions, inputValue: t.cat, showCancelButton: true, confirmButtonColor: '#6366f1' });
        if (nCat) { 
            t.cat = nCat;
            t.catIdx = CATEGORIES[lang].indexOf(nCat);
        }
        save(); render();
    }

    function verifyLock() { 
        const input = document.getElementById("unlockPass");
        const errorMsg = document.getElementById("lock-error");
        if(input.value === sfrPass) { 
            document.getElementById("lock-screen").style.display = "none"; 
            document.getElementById("mainApp").style.display = "block"; 
            errorMsg.style.display = "none";
            render(); 
        } else {
            errorMsg.style.display = "block";
            input.value = "";
            input.focus();
            input.style.border = "2px solid var(--danger)";
        }
    }

    function hideLockError() {
        document.getElementById("lock-error").style.display = "none";
        document.getElementById("unlockPass").style.border = "1px solid #ddd";
    }

    async function checkCurrentPass() {
        if (!sfrPass) return true;
        const { value: check } = await Swal.fire({ title: dict[lang].enterCurrPass, input: 'password', showCancelButton: true, confirmButtonColor: '#6366f1' });
        if (check === sfrPass) return true;
        if (check !== undefined) Swal.fire({ icon: 'error', text: dict[lang].errPass });
        return false;
    }

    async function handleSetPass() { 
        if(await checkCurrentPass()) {
            const { value: p } = await Swal.fire({ title: dict[lang].enterNewPass, input: 'password', showCancelButton: true, confirmButtonColor: '#6366f1' }); 
            if(p) { localStorage.setItem("sfr_v6_pass", p); sfrPass = p; location.reload(); } 
        }
    }

    async function deletePass() { 
        if(await checkCurrentPass()) { 
            localStorage.removeItem("sfr_v6_pass"); sfrPass = null; location.reload(); 
        } 
    }

    let cExp = "0";
    function openCalc() { document.getElementById("calcModal").style.display = "flex"; }
    function closeCalc() { document.getElementById("calcModal").style.display = "none"; }
    function calcIn(v) { if(cExp === "0") cExp = v; else cExp += v; document.getElementById("calcDisplay").innerText = cExp; }
    function calcClear() { cExp = "0"; document.getElementById("calcDisplay").innerText = cExp; }
    function calcPop() { cExp = cExp.slice(0, -1); if(cExp==="") cExp="0"; document.getElementById("calcDisplay").innerText = cExp; }
    function calcRes() { try { cExp = eval(cExp).toString(); document.getElementById("calcDisplay").innerText = cExp; } catch { cExp = "Error"; document.getElementById("calcDisplay").innerText = cExp; cExp = "0"; } }

    function openPrivacy() { document.getElementById("privacy-modal").style.display = "block"; }
    function closePrivacy() { document.getElementById("privacy-modal").style.display = "none"; }
</script>
</body>
</html>
